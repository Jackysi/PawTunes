var u=class{constructor(a){this.socket=null;this.pawtunes=a}isWebSocketActive(){return this.socket&&this.socket.readyState!==WebSocket.CLOSED}close(){return new Promise(a=>{if(this.isWebSocketActive()){let t=this.socket;t.onclose=()=>{console.log("Websocket connection closed"),this.socket=null,a(!0)},t.onerror=()=>{this.socket=null,a(!0)},t.close();return}a(!0)})}connectToSocket(a,t){this.pawtunes.showLoading(),this.socket=new WebSocket(a),this.socket.onopen=()=>{let e=this.socket,i=`station:${t}`;e.send(JSON.stringify({subs:{[i]:{recover:!0}}})),this.pawtunes.hideLoading(),console.log("Websocket connection established"),e.onmessage=n=>{let r=JSON.parse(n.data);if(r.connect&&r.connect.subs[i]){let o=r.connect.subs[i];o.publications&&o.publications.length>=1&&o.publications[0]?.data?.np&&this.handleAzuraData(o.publications[0].data.np)}r.channel===i&&r.pub?.data?.np?.now_playing&&this.handleAzuraData(r.pub.data.np)},e.onerror=n=>{this.pawtunes.hideLoading(),console.log("Websocket connection error: "+n),this.pawtunes.state==="online"&&this.connectToSocket(a,t)},e.onclose=()=>{console.log("Websocket connection closed"),this.pawtunes.hideLoading(),this.connectToSocket(a,t)}}}handleAzuraData(a){let t={artist:null,title:null,artwork:null,history:[]},e=a.now_playing.song;t.artist=e.artist,t.title=e.title,t.artwork=!this.pawtunes.channel.ws.useRemoteCovers||!e.art?this.pawtunes.pawArtworkURL(e.artist,e.title):e.art,this.pawtunes.channel.ws.history&&a.song_history&&a.song_history.forEach(i=>{t.history.push({artist:i.song.artist,title:i.song.title,artwork:!this.pawtunes.channel.ws.useRemoteCovers||!i.song.art?this.pawtunes.pawArtworkURL(i.song.artist,i.song.title):i.song.art,time:i.played_at*1e3})}),this.pawtunes.handleOnAirResponse(t)}};var p=class{constructor(){this._events={};this._eventsCount=0}eventNames(){let a=[];if(this._eventsCount===0)return a;for(let t in this._events)Object.prototype.hasOwnProperty.call(this._events,t)&&a.push(t);return typeof Object.getOwnPropertySymbols=="function"&&a.push(...Object.getOwnPropertySymbols(this._events)),a}listeners(a){let t=this._events[a];return t?t.fn?[t.fn]:t.map(e=>e.fn):[]}listenerCount(a){let t=this._events[a];return t?t.fn?1:t.length:0}emit(a,...t){let e=a;if(!this._events[e])return!1;let i=this._events[e];if(i.fn){let n=i;n.once&&this.removeListener(a,n.fn,void 0,!0),n.fn.apply(n.context,t)}else{let n=i.slice();for(let r of n)r.once&&this.removeListener(a,r.fn,void 0,!0),r.fn.apply(r.context,t)}return!0}on(a,t,e){return this.registerListener(a,t,e,!1)}once(a,t,e){return this.registerListener(a,t,e,!0)}removeListener(a,t,e,i){let n=a;if(!this._events[n])return this;if(!t)return this.clearEvent(n),this;let r=this._events[n];if(r.fn){let o=r;o.fn===t&&(!i||o.once)&&(!e||o.context===e)&&this.clearEvent(n)}else{let o=r.filter(l=>l.fn!==t||i&&!l.once||e&&l.context!==e);o.length?this._events[n]=o.length===1?o[0]:o:this.clearEvent(n)}return this}removeAllListeners(a){if(a){let t=a;this._events[t]&&this.clearEvent(t)}else this._events={},this._eventsCount=0;return this}off(a,t,e,i){return this.removeListener(a,t,e,i)}addListener(a,t,e){return this.on(a,t,e)}registerListener(a,t,e,i){if(typeof t!="function")throw new TypeError("The listener must be a function");let n={fn:t,context:e||this,once:i},r=a;return this._events[r]?this._events[r].fn?this._events[r]=[this._events[r],n]:this._events[r].push(n):(this._events[r]=n,this._eventsCount++),this}clearEvent(a){--this._eventsCount===0?this._events={}:delete this._events[a]}};var d=class extends p{constructor(t=""){super();this.autoplay=!1;this.volume=50;this.muteVolume=0;this.ready=!1;this.audio=null;this.media=[];this.debug=!1;this.streamEvents=["loadstart","durationchange","loadedmetadata","loadeddata","progress","canplay","canplaythrough","play","playing","timeupdate","seeking","seeked","ratechange","volumechange","pause","ended","waiting","stalled","suspend","emptied","abort","error"];this.formats={mp3:{codec:"audio/mpeg",media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',media:"audio"},m3u8a:{codec:'application/vnd.apple.mpegurl; codecs="mp4a.40.2"',media:"audio"},m3ua:{codec:"audio/mpegurl",media:"audio"},oga:{codec:'audio/ogg; codecs="vorbis, opus"',media:"audio"},flac:{codec:"audio/x-flac",media:"audio"},wav:{codec:'audio/wav; codecs="1"',media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',media:"audio"},fla:{codec:"audio/x-flv",media:"audio"},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',media:"audio"}};this.selectorsPrefix=".pawtunes";this.selectors={player:".player",play:".play",stop:".stop",mute:".volume-icon .volume",unmute:".volume-icon .muted",volumeContainer:".volume-control",volumeBar:".volume-slider .vol-progress",volumeValue:".volume-slider .vol-progress .vol-bar",volumeHandle:".volume-slider .vol-progress .vol-bar .circle-control"};this.noVolumeControl={ipad:/ipad/,iphone:/iphone/,ipod:/ipod/,android_pad:/android(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/,playbook:/playbook/};this.isAndroid=this.matchBrowser({mobile:/(android)/});this.isMobile=this.matchBrowser({mobile:/(mobile)/});this.isNoVolume=this.matchBrowser(this.noVolumeControl);if(t===""&&(t=this.selectorsPrefix),!document.querySelector(t))throw new Error("HTML5 Audio container element not found: "+t);this.selectorsPrefix=t}setup(){this.destroy(),this.audio=new Audio,this.audio.preload="none",this.audio.controls=!1,this.audio.crossOrigin="anonymous",this.isNoVolume||(this.volume>=1&&this.volume<=100?this.audio.volume=this.volume/100:(this.audio.muted=!0,this.audio.volume=0)),this.isNoVolume&&(this.volume=100,this.audio.volume=1,this.updateUI("disable-volume")),this.media.length>=1&&this.setMedia(this.media),this.updateUI("stopped"),this.updateUI("volumechange"),this.bindStreamEvents(),this.trigger("init")}async setMedia(t){if(!this.audio)throw new Error("No audio element found!");this.media.length>0&&(this.media=[]);let e=0;for(let i of t)if(this.formats[i.type]){let n=this.audio.canPlayType(this.formats[i.type].codec);if(n!=="probably"&&n!=="maybe")continue;this.media.push(i),e++}if(e>0&&(this.audio.src=this.media[0].src),e<1){this.ready=!1,this.trigger("error",{code:4,message:"No playable sources found"});return}this.ready=!0,this.trigger("ready")}bindStreamEvents(){this.streamEvents.forEach(t=>{this.audio&&this.audio.addEventListener(t,()=>{if(t==="error"){this.trigger(t,this.audio?.error);return}this.trigger(t)})})}status(){return this.audio?{currentTime:this.audio.currentTime,duration:this.audio.duration,paused:this.audio.paused,ended:this.audio.ended,playbackRate:this.audio.playbackRate,volume:this.audio.volume,muted:this.audio.muted,seeking:this.audio.seeking,buffered:this.audio.buffered,readyState:this.audio.readyState,networkState:this.audio.networkState,loop:this.audio.loop,preload:this.audio.preload,autoplay:this.audio.autoplay,src:this.audio.currentSrc||this.audio.src,textTracks:this.audio.textTracks,error:this.audio.error}:null}async play(){try{!this.ready&&this.media.length>=1&&(this.updateUI("play"),await this.setMedia(Object.assign([],this.media)),this.ready=!0,await this.play()),this.audio&&this.ready&&await this.audio.play()}catch(t){this.trigger("error",{code:4,message:t})}}async stop(){this.audio&&this.ready&&(this.trigger("stop"),this.audio.pause(),this.audio.autoplay=!1,this.audio.currentTime=0,this.clearMedia(),this.media.length>=1&&await this.setMedia(Object.assign([],this.media)))}pause(){this.audio&&this.audio.pause()}mute(){this.audio&&(this.muteVolume=this.volume,this.audio.volume=0)}unmute(){this.audio&&(this.audio.volume=this.muteVolume/100,this.muteVolume=0)}matchBrowser(t){let e=navigator.userAgent.toLowerCase();return Object.values(t).some(i=>i.test(e))}clearMedia(){if(this.audio){this.audio.pause(),this.audio.src="";for(let t of this.audio.children)t.tagName==="SOURCE"&&this.audio.removeChild(t)}this.ready=!1}destroy(){this.audio&&(this.audio.pause(),this.audio.src="",this.audio.currentTime=0),this.audio=null,this.ready=!1}updateUI(t){}trigger(t,e=null){switch(this.debug&&console.log("Event logging:",t,e,this.status()),t){case"loadstart":this.audio?.autoplay&&t==="loadstart"&&(this.updateUI("play"),this.updateUI("seeking"));break;case"play":case"waiting":let i=this.status();i&&i.readyState<HTMLMediaElement.HAVE_CURRENT_DATA&&this.updateUI("seeking"),this.updateUI("play");break;case"stalled":case"seeking":this.updateUI("seeking");break;case"playing":this.updateUI("playing");break;case"abort":case"pause":case"ended":case"stop":this.emit("stopped"),this.updateUI("stopped");return;case"suspend":this.status()?.readyState===0&&this.trigger("stop");break;case"error":if(this.stop(),e.length<1)return;break;case"volumechange":if(!this.audio)return;this.volume=Math.round(this.audio.volume*100),this.audio.muted=this.volume===0,this.updateUI("volumechange");break;default:break}e||(e=this.status()),this.emit(t,e)}};var c=class{constructor(a=""){this.prefix="";this.prefix=a}isLocalStorageSupported(){return typeof window.localStorage<"u"}set(a,t,e=0){if(!this.isLocalStorageSupported()||!a)return!1;if(a=this.prefix+a,localStorage.setItem(a,t),e>0){let i=new Date;i.setSeconds(i.getSeconds()+e),localStorage.setItem(a+"_expires",i.getTime().toString())}return!0}get(a){return!this.isLocalStorageSupported()||!a||(a=this.prefix+a,localStorage.getItem(a)==null)?!1:localStorage.getItem(a+"_expires")!==null&&new Date().getTime()>parseInt(localStorage.getItem(a+"_expires")??"")?(this.delete(a),!1):localStorage.getItem(a)??!1}delete(a){return!this.isLocalStorageSupported()||!a?!1:(a=this.prefix+a,localStorage.removeItem(a),localStorage.removeItem(a+"_expires"),!0)}};var y=class extends d{constructor(t,e){super(t);this.onAir={artist:"",title:"",artwork:null,time:0};this.artworkTypes={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml"};this.fatal=!1;this.debug=!1;this.currentPage="main";this.channel={name:"",logo:null,skin:"",ws:{},streams:{}};this.history=[];this.prefix=btoa(window.location.pathname).replace(/=/g,"")+"_";this.stream=null;this.state="online";this.temp=[];this.timers={};this.url=window.location.href.split("#")[0];this.language={error:"ERROR",error_create:"Unable to find channels, please create one!",error_defined:"NO CHANNELS DEFINED",error_invalid:"Invalid Channel!",error_network:"ERROR: Network error occurred!",error_playback:"ERROR: Playback failed, loading stream failed!",error_stream:"ERROR: The specified or selected stream does not exist!",history_added:"Added",history_artist_title:"Artist/Title",history_hour_ago:"hr ago",history_just_now:"just now",history_min_ago:"min ago",history_sec_ago:"sec ago",loading_message:"Loading, please wait...",history_no_history:"No history available at this time.",share:"Share",song_history:"Song History",status_init:"Loading {STREAM}...",status_muted:"Player muted.",status_playing:"Playing {STREAM}...",status_stopped:"Player stopped.",status_volume:"Volume: {LEVEL}",twitter_share:"I am listening to {TRACK}!",ui_back:"Back",ui_channels:"Channels list",ui_history:"Show Track History",ui_play:"Start playing",ui_playlists:"Listen in your favorite player",ui_settings:"Select stream quality",ui_stop:"Stop playing",ui_volume_circle:"Drag to change volume"};this.settings={api:"",analytics:!1,defaults:{autoplay:!1,channel:"",default_volume:50},dynamicTitle:!0,history:!0,historyMaxLen:20,refreshRate:10,template:"pawtunes",tpl:{},title:"PawTunes",trackInfo:{artistMaxLen:24,titleMaxLen:28,lazyLoadArtworks:!1,lazyLoadURL:"./index.php?artwork&artist={ARTIST}&title={TITLE}",default:{artist:"Various Artists",title:"Unknown Track",artwork:"./data/images/default.png"}},showTimer:!0};if(this.prefix=e.prefix??this.prefix,this.storage=new c(this.prefix),this.volume=e.defaults.default_volume?e.defaults.default_volume:50,this.storage.get("last-volume")!==!1&&this.storage.get("last-volume")>=0&&this.storage.get("last-volume")<=100&&(this.volume=parseInt(this.storage.get("last-volume"))),this.settings=this.deepCloneLeftSide(this.settings,e),this.settings.tpl=e.tpl?e.tpl:this.settings.tpl,this.autoplay=this.settings.defaults.autoplay,this.language=e.language,this.channels=e.channels??[],this.debug=e.debug??!1,this.ws=new u(this),this.channels.length<1&&this.renderFatalError(this.translate("error_create")),this.channels.length>=1){let i=!1;for(let n=0;n<this.channels.length;n++)if(Object.keys(this.channels[n].streams).length>0){i=!0;break}i||this.renderFatalError(this.translate("error_stream"))}}async init(){if(this.fatal)return;this.setup(),this.bindPlayerControls(),this.bindPlayerEvents(),this.bindEvents(),this.setupHistory();let t=decodeURIComponent(window.location.href.split("#")[1]||"");window.addEventListener("hashchange",()=>{t=decodeURIComponent(window.location.href.split("#")[1]||""),this.setChannel(t),this.setStream(),this.play()}),this.setChannel(t),this.setStream(),this.generateChannelsDOM(),this.generateStreamsDOM(),this.dropdownMenus(),this.createGoogleAnalytics()}onAirTimer(){if(!this.settings.showTimer||this.onAir.time<=0)return;let t=(new Date().getTime()-this.onAir.time)/1e3,e=Math.floor(t/3600%60),i=Math.floor(t/60%60),n=Math.floor(t%60),r;e>=1?r=`${e<10?"0":""}${e}:${i<10?"0":""}${i}:${n<10?"0":""}${n}`:r=`${i<10?"0":""}${i}:${n<10?"0":""}${n}`,this.writeText(".onair .time",r)}async trackInfoInit(){if(this.timers.trackInfo&&clearInterval(this.timers.trackInfo),this.ws.isWebSocketActive()&&await this.ws.close(),!this.channel||!this.channel.name)return;if(this.channel.ws&&this.channel.ws.url){this.ws.connectToSocket(this.channel.ws.url,this.channel.ws.station);return}let t=()=>{fetch(`${this.settings.api}?channel=${this.channel.name}`).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{this.handleOnAirResponse(e)}).catch(e=>{console.error("There was a problem with the fetch operation:",e)})};t(),this.timers.trackInfo=setInterval(t,this.settings.refreshRate*1e3)}handleOnAirResponse(t){if(!t.artist||!t.title){console.error("Invalid data or no data received from the server.");return}if(!(t.artist==this.onAir.artist&&t.title==this.onAir.title&&t.artwork==this.onAir.artwork))if(this.writeHTML(".onair .artist",`<span class="pointer css-hint" data-title="${t.artist}">${this.shorten(t.artist,this.settings.trackInfo.artistMaxLen)}</span>`),this.writeHTML(".onair .title",`<span class="pointer css-hint" data-title="${t.title}">${this.shorten(t.title,this.settings.trackInfo.titleMaxLen)}</span>`),this.settings.dynamicTitle&&(this.temp.title==null&&(this.temp.title=document.title),document.title=`${t.artist} - ${t.title} | ${this.temp.title}`),this.onAir={artist:t.artist,title:t.title,artwork:t.artwork??null,time:new Date().getTime()},this.loadArtwork(t.artwork),this.handleMetaChange(),this.emit("track.change",this.onAir),t.history&&t.history.length>=1){t.history.sort((e,i)=>e.time-i.time),this.history=[];for(let e of t.history)this.addHistoryEntry(e);this.updateHistoryDOM()}else this.addHistoryEntry(this.onAir),this.updateHistoryDOM()}loadArtwork(t){if(!t&&!this.settings.trackInfo.default.artwork){this.hideLoading();return}this._(".artwork",e=>{this.showLoading(),e.setAttribute("src",t??this.settings.trackInfo.default.artwork),e.addEventListener("load",()=>{this.hideLoading()}),e.addEventListener("error",()=>{e.getAttribute("src")!=this.settings.trackInfo.default.artwork&&e.setAttribute("src",this.settings.trackInfo.default.artwork)})})}showLoading(){let t=this.getElm(".artwork-preloader");t&&t.classList.remove("hidden")}hideLoading(){let t=this.getElm(".artwork-preloader");t&&t.classList.add("hidden")}pawArtworkURL(t,e){return this.settings.trackInfo.lazyLoadURL.replace("{ARTIST}",t).replace("{TITLE}",e)}_(t,e=()=>{},i=document,n=!0){t in this.selectors&&(t=this.selectors[t]),n&&(t=`${this.selectorsPrefix} ${t}`);let r=(i||document).querySelectorAll(t),o=[];for(let l of r)e&&e(l),o.push(l);return o}translate(t,e,i){return!e||!i?this.language[t]??"":this.language[t].replace(`{${e}}`,i)}pagination(t="",e=!0){let i=this._(".main-container .view");if(i.length<1){document.removeEventListener("resize",this.temp.resizePaginationEvent);return}t===""&&(t=this.currentPage);let n=i[0].offsetWidth,r=i.length,o=0;for(let l=0;l<r;l++)if(i[l].classList.contains(t)){this.currentPage=t,o=l;break}e||(i[0].style.transition="none",setTimeout(()=>{i[0].style.transition=""},0)),i[0].style.marginLeft="-"+(o!==0?n*o:0)+"px"}async bindEvents(){this.temp.resizePaginationEvent=()=>this.pagination("",!1),window.addEventListener("resize",this.temp.resizePaginationEvent),window.addEventListener("online",()=>{this.state="online",this.emit("status","online"),this.trackInfoInit(),this.temp.lastState?.paused===!1&&this.play(),console.log("We are online...")}),window.addEventListener("offline",()=>{this.state="offline",this.emit("status","offline"),this.temp.lastState=this.status(),console.warn("We are offline!")}),window.addEventListener("beforeunload",()=>{this.ws&&this.ws.isWebSocketActive()&&this.ws.close()})}bindPlayerEvents(){this.on("play",()=>{"mediaSession"in navigator&&(navigator.mediaSession.playbackState="playing"),this.toast(this.translate("status_init","STREAM",this.channel.name),!0),this.settings.showTimer&&(this.onAir.time=new Date().getTime(),this.onAirTimer())}),this.on("playing",()=>{this.handleMetaChange(),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="playing"),this.toast(this.translate("status_playing","STREAM",this.channel.name),!0)}),this.on("stopped",()=>{this.toast(this.translate("status_stopped"),!1),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused"),this.settings.showTimer&&(this.onAir.time=new Date().getTime(),this.writeText(".onair .time","00:00"))}),this.on("error",t=>{t.code&&t.code===4&&(this.status()?.networkState??0)>=HTMLMediaElement.HAVE_CURRENT_DATA||(this.toast(this.translate("error_network"),!0),this.status()?.readyState===HTMLMediaElement.HAVE_NOTHING&&this.toast(this.translate("error_playback"),!0))}),this.on("volumechange",()=>{this.volume<=1?this.toast(this.translate("status_muted")):this.toast(this.translate("status_volume","LEVEL",`${this.volume}%`)),this.storage.set("last-volume",this.volume)}),this.on("timeupdate",()=>{this.settings.showTimer&&this.onAirTimer()}),"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",()=>this.play()),navigator.mediaSession.setActionHandler("pause",()=>{"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused"),this.stop(),this.toast(this.translate("status_stopped"),!0)}))}generateChannelsDOM(){if(this.channels.length<1){alert(this.translate("error_defined")),this.toast(this.translate("error_defined"));return}let t=this.getElm(" .channels"),e=this.getElm(".channel-list",t);if(!(!t||!e)){if(e.innerHTML="",this.channels.length<=1){t.classList.add("hidden");return}for(let i of this.channels){let n=document.createElement("li");n.classList.add("channel"),n.innerHTML=`<a href="#" data-channel="${i.name}">${i.name}</a>`,n.addEventListener("click",async r=>{r.preventDefault(),this._(".channel",o=>o.classList.remove("active"),e),n.classList.add("active"),t.classList.remove("active"),this.setChannel(i.name),this.setStream(),this.generateStreamsDOM(),await this.play()}),this.channel&&this.channel.name===i.name&&n.classList.add("active"),e.appendChild(n)}t.classList.remove("hidden")}}generateStreamsDOM(){let t=this.getElm(" .settings"),e=this.getElm(".streams-list",t);if(!(!t||!e)){if(e.innerHTML="",!this.channel||typeof this.channel.streams!="object"||Object.keys(this.channel.streams).length<=1)return t.classList.add("hidden"),null;for(let i of Object.keys(this.channel.streams)){let n=document.createElement("li");n.classList.add("stream"),n.innerHTML=`<a data-stream="${i}" href="#">${i}</a>`,n.addEventListener("click",async r=>{r.preventDefault(),this._(".stream",o=>o.classList.remove("active"),e),n.classList.add("active"),t.classList.remove("active"),this.setStream(i),await this.play()}),this.stream&&this.stream===i&&n.classList.add("active"),e.appendChild(n)}t.classList.remove("hidden")}}setupHistory(){if(!this.settings.history)return;let t=this._(".history-list-container .history-item");t.length>=1&&(this.historyTemplate=t[0],this.historyTemplate.classList.remove("hidden")),this._(".history-toggle",e=>{e.classList.remove("hidden");let i=this.getElm("a",e),n=!1;i.addEventListener("click",r=>{if(r.preventDefault(),!n){n=!0,e.classList.add("active"),this.pagination("history");return}n=!1,e.classList.remove("active"),this.pagination("main")})}),this.timers.historyTimeAgo=setInterval(()=>this.historyTimeTrack(),1e3)}updateHistoryDOM(){let t=this.getElm(" .history-content .history-list-container"),e=this.getElm(" .history-content .history-unavailable"),i=this.getElm(" .history-content .history-list");if(t&&(t.innerHTML=""),t&&this.historyTemplate&&this.history.length>=1){for(let n of this.history){let r=new Date(n.time),o=this.historyTemplate.cloneNode(!0);o.setAttribute("data-title",r.getHours()+":"+(r.getMinutes()<=9?"0"+r.getMinutes():r.getMinutes())),o.setAttribute("data-unix",String(r.getTime())),this.writeText(".history-track",`${n.artist} - ${n.title}`,o),this.writeText(".history-time-ago",this.ago(n.time),o);let l=n.artwork?n.artwork:this.settings.trackInfo.default.artwork;this.writeHTML(".history-artwork",'<div class="artwork-preloader"></div>',o);let h=new Image;h.src=l,h.onload=()=>this.writeHTML(".history-artwork",`<img src="${l}" alt="image" class="history-artwork-image">`,o),h.onerror=()=>{h.src!==this.settings.trackInfo.default.artwork&&this.writeHTML(".history-artwork",`<img src="${this.settings.trackInfo.default.artwork}" alt="image" class="history-artwork-image">`,o)},t.append(o)}e?.classList.add("hidden"),i?.classList.remove("hidden")}else e?.classList.remove("hidden"),i?.classList.add("hidden");this.emit("history.change",{history:this.history})}historyTimeTrack(){let t=this._(" .history-content .history-list-container .history-item");t.length>0&&t.forEach(e=>{let i=e,n=this.getElm(".history-time-ago",i);n&&i.dataset.unix&&(n.textContent=this.ago(parseInt(i.dataset.unix)))})}addHistoryEntry(t){this.history.length>=this.settings.historyMaxLen&&this.history.pop(),this.history.unshift(t)}setChannel(t=""){this.showLoading(),this.findChannel(t),this.storage.set("last-channel",this.channel.name),this.emit("channel.change",this.channel),this.channelDOMChange(this.channel.skin),this.history=[],this.updateHistoryDOM(),this.trackInfoInit()}createGoogleAnalytics(){if(!this.settings.analytics||typeof this.settings.analytics!="string")return!1;window.dataLayer=window.dataLayer||[];let t=document.createElement("script");t.src="https://www.googletagmanager.com/gtag/js?id="+this.settings.analytics,t.async=!0,t.onload=function(){function e(){window.dataLayer.push(arguments)}e("js",new Date),e("config",s.analytics)},window.document.body.appendChild(t)}toast(t=null,e=!1){this.emit("status.change",t);let i=this._(".player-status")[0];return i==null?null:t?(e&&(this.temp.notification=t),this.timers.notify&&clearTimeout(this.timers.notify),i.textContent=t??"",e||(i.classList.remove("text-animate"),this.timers.notify=setTimeout(()=>{this.emit("status.change",this.temp.notification),i.textContent=this.temp.notification??"",i.classList.add("text-animate")},2e3)),null):i.textContent}shorten(t="",e=0){if(t===""||e===0)return t;let i=e||10;return t.length>i&&(t=t.substring(0,i)+"&hellip;"),t}ago(t){let e=Math.floor((new Date().getTime()+new Date().getTimezoneOffset()-t)/1e3);return Math.floor(e/3600)>=1?`${Math.floor(e/3600)} ${this.translate("history_hour_ago")}`:Math.floor(e/60)>=1?`${Math.floor(e/60)} ${this.translate("history_min_ago")}`:e===0?this.translate("history_just_now"):`${Math.floor(e)} ${this.translate("history_sec_ago")}`}handleMetaChange(){if("mediaSession"in navigator){let t=[];if(this.onAir.artwork){let e=this.onAir.artwork,i=this.onAir.artwork.split(/[#?]/)[0]?.split(".")?.pop()?.trim()??"",n="",r=["96x96","128x128","192x192","256x256","384x384","320x180","512x512"];for(let[o,l]of Object.entries(this.artworkTypes))if(o===i){n=l;break}for(let o=0;o<r.length;o++)t.push({src:e,sizes:r[o],type:n!==""&&n!=="/"?n:null})}navigator.mediaSession.metadata=new window.MediaMetadata({artist:this.onAir.artist,title:this.onAir.title,album:"",artwork:t})}}deepCloneLeftSide(t,e){let i={};for(let n in t){if(typeof t[n]=="object"&&t[n]!==void 0){if(n in e){i[n]=this.deepCloneLeftSide(t[n],e[n]);continue}i[n]=this.deepCloneLeftSide(t[n],{});continue}i[n]=typeof e[n]>"u"?t[n]:e[n]}return i}writeHTML(t,e,i=document){this._(t,n=>{n.innerHTML=e},i,!1)}writeText(t,e,i=document){this._(t,n=>{n.textContent=e},i,!1)}getElm(t,e=document,i=!0){return this._(t,null,e,i)[0]}setStream(t=""){if(this.channel.streams){if(t===""||!this.channel.streams[t]){let e=this.storage.get(`last-stream-${this.channel.name}`);e&&this.channel.streams[e]?t=e:t=Object.keys(this.channel.streams)[0]}if(this.channel.streams[t]){this.stream=t,this.streamToMedia(),this.storage.set(`last-stream-${this.channel.name}`,t),this.emit("stream.change",t);return}this.toast(this.translate("error_stream"))}}renderFatalError(t){this.fatal=!0,this._("#no-js-hide",e=>{e.innerHTML=`<span style="color:red; font-weight: 500; font-size: 16px;">ERROR: ${t}</span>`})}bindPlayerControls(){this._("play",t=>t.addEventListener("click",()=>this.play())),this._("stop",t=>t.addEventListener("click",()=>this.stop())),this._("mute",t=>t.addEventListener("click",()=>this.mute())),this._("unmute",t=>t.addEventListener("click",()=>this.unmute())),this.handleVolumeUI()}handleVolumeUI(){let t=!1,e=l=>{l.preventDefault();let h=this._("volumeBar")[0];if(!this.audio||!h)return;let g,v=h.getBoundingClientRect();if("touches"in l&&l.touches&&l.touches.length>0)g=l.touches[0].clientX;else if("clientX"in l&&l.clientX!==void 0)g=l.clientX;else return;let f=(g-v.left)/v.width*100;f=Math.max(0,Math.min(100,f)),this.audio.volume=f/100},i=l=>{t=!0,e(l)},n=l=>{t&&e(l)},r=l=>{t&&(t=!1,e(l))},o=l=>{l.preventDefault(),l.deltaY<0?this.volume=Math.max(0,Math.min(100,this.volume+2)):this.volume=Math.max(0,Math.min(100,this.volume-2)),this.audio&&(this.audio.volume=this.volume/100)};this._("volumeHandle",l=>l.addEventListener("mousedown",i)),this._("volumeBar",l=>l.addEventListener("mousedown",i)),document.addEventListener("mousemove",n),document.addEventListener("mouseup",r),this._("volumeHandle",l=>l.addEventListener("touchstart",i)),document.addEventListener("touchmove",n),document.addEventListener("touchend",r),this._("volumeContainer",l=>l.addEventListener("wheel",o))}updateUI(t){switch(t){case"seeking":this._("player",e=>e.classList.add("paw-seeking"));break;case"playing":this._("player",e=>e.classList.remove("paw-seeking"));case"play":this._("play",e=>e.classList.add("hidden")),this._("stop",e=>e.classList.remove("hidden"));break;case"stopped":this._("play",e=>e.classList.remove("hidden")),this._("stop",e=>e.classList.add("hidden")),this._("player",e=>e.classList.remove("paw-seeking"));break;case"volumechange":this._("volumeValue",e=>e.style.width=`${this.volume}%`),this._("volumeHandle",e=>e.setAttribute("aria-valuenow",`${this.volume}`)),this.isNoVolume||(this.volume===0?(this._("mute",e=>e.classList.add("hidden")),this._("unmute",e=>e.classList.remove("hidden"))):(this._("mute",e=>e.classList.remove("hidden")),this._("unmute",e=>e.classList.add("hidden"))));break;case"disable-volume":this._("player",e=>e.classList.add("no-volume")),this._("volumeBar",e=>e.classList.add("hidden")),this._("mute",e=>e.classList.add("hidden")),this._("unmute",e=>e.classList.add("hidden"));break}}channelDOMChange(t){return this.channel.logo&&this._(".logo img",e=>{this.temp.logo||(this.temp.logo=e.getAttribute("src"));let i=new Image;i.src=this.channel.logo,i.onload=()=>e.setAttribute("src",i.src),i.onerror=()=>e.setAttribute("src",this.temp.logo)}),!this.channel.logo&&this.temp.logo&&this._(".logo img",e=>{e.setAttribute("src",this.temp.logo)}),this._("#main_theme",e=>{if(this.temp.skin||(this.temp.skin=e.getAttribute("href")),t){e.setAttribute("href",`templates/${this.settings.template}/${t}`),this.emit("theme.change");return}!t&&this.temp.skin&&e.getAttribute("href")!==this.temp.skin&&(e.setAttribute("href",this.temp.skin),this.emit("theme.change"))},document,!1)}dropdownMenus(){let t=this._('[data-toggle="dropdown"]');for(let e of t)e.addEventListener("click",i=>{i.preventDefault();let n=e.parentNode;if(n){if(n.classList.contains("active"))return n.classList.remove("active"),!1;this._('[data-toggle="dropdown"]').forEach(function(r){r.parentNode?.querySelector(".dropdown")?.classList.remove("active")}),n.classList.add("active"),document.addEventListener("click",function(r){r.target!==n&&!n.contains(r.target)&&n.classList.remove("active")})}})}async streamToMedia(){if(!this.stream||!this.channel.streams[this.stream])return;let t=[];for(let e of Object.keys(this.channel.streams[this.stream]))t.push({type:e,src:this.channel.streams[this.stream][e]});try{this.setMedia(t),this.autoplay&&(await this.play(),this.updateUI("play"),this.autoplay=!1)}catch(e){this.emit("error",e)}}findChannel(t=""){if(t!==""&&this.findObjectByKey(this.channels,"name",t)){this.channel=this.findObjectByKey(this.channels,"name",t);return}let e=this.storage.get("last-channel");if(e&&this.findObjectByKey(this.channels,"name",e)){this.channel=this.findObjectByKey(this.channels,"name",e);return}if(this.settings.defaults.channel!==""&&this.findObjectByKey(this.channels,"name",this.settings.defaults.channel)){this.channel=this.findObjectByKey(this.channels,"name",this.settings.defaults.channel);return}this.channel=this.channels[0]}findObjectByKey(t,e,i){for(let n=0;n<t.length;n++)if(t[n][e]===i)return t[n];return null}};export{y as default};
//# sourceMappingURL=pawtunes.min.js.map
